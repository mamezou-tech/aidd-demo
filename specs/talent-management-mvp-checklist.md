# タレントマネジメントMVP仕様 - チェック観点リスト

**Version**: 1.0.0  
**Created**: 2025-11-14  
**Related Spec**: talent-management-mvp.md

## 1. 検索条件の組み合わせ

### 1.1 基本検索パターン

**チェック項目**:
- [ ] 単一条件での検索（氏名のみ、社員IDのみ、など）
- [ ] 複数条件のAND検索（氏名 + 所属組織、など）
- [ ] 部分一致検索の範囲（氏名の前方一致、中間一致、後方一致）
- [ ] カナ検索の扱い（全角/半角、大文字/小文字）
- [ ] 空白文字の扱い（氏名に含まれるスペース）

**仕様の明確化が必要な点**:
1. 氏名検索は「姓」「名」を別々に検索できるか、フルネームのみか？
2. 部分一致検索の方式は？（前方一致、中間一致、完全一致）
3. カナ検索は全角カタカナのみか、ひらがなも許容するか？

### 1.2 スキル検索の組み合わせ

**チェック項目**:
- [ ] 単一スキルでの検索
- [ ] 複数スキルのAND検索（JavaとAWSの両方を持つ社員）
- [ ] 複数スキルのOR検索（JavaまたはAWSを持つ社員）
- [ ] スキルレベルを含めた検索（Java上級以上、など）
- [ ] スキルカテゴリでの検索（技術スキル全般、など）

**仕様の明確化が必要な点**:
1. 複数スキル検索はANDかORか、両方サポートするか？
2. スキルレベルを検索条件に含められるか？
3. 「スキルなし」の社員を検索できるか？

### 1.3 組織検索の範囲

**チェック項目**:
- [ ] 特定組織のみの検索
- [ ] 特定組織配下（子組織含む）の検索
- [ ] 複数組織のOR検索
- [ ] 組織未所属の社員の扱い

**仕様の明確化が必要な点**:
1. 組織検索は直属のみか、配下の組織も含むか？
2. 組織階層の深さに制限はあるか？
3. 組織未所属の社員は存在するか？

### 1.4 検索結果の扱い

**チェック項目**:
- [ ] 検索結果0件の場合のメッセージ
- [ ] 検索結果が1000件を超える場合の挙動
- [ ] 削除済み社員は検索結果に含まれないことの確認
- [ ] 検索条件の保持（ページ遷移後に戻った場合）

**仕様の明確化が必要な点**:
1. 検索結果の最大件数制限はあるか？
2. 1000件を超える場合、エラーか警告か？
3. 検索条件はセッションに保持するか？

## 2. 顔写真アップロード／表示のエラーケース

### 2.1 アップロード時のバリデーション

**チェック項目**:
- [ ] ファイル形式チェック（JPEG/PNG以外）
- [ ] ファイルサイズチェック（2MB超過）
- [ ] ファイル名の文字コードチェック（日本語ファイル名など）
- [ ] 画像の解像度チェック（極端に大きい/小さい画像）
- [ ] 破損ファイルのチェック
- [ ] ウイルススキャン（MVP対象外の可能性あり）

**仕様の明確化が必要な点**:
1. 許可する画像形式は？（JPEG、PNG、GIF、WebPなど）
2. 最小/最大解像度の制限は？
3. アスペクト比の制限は？（正方形推奨など）
4. ファイル名の制限は？

### 2.2 アップロード処理のエラーハンドリング

**チェック項目**:
- [ ] ストレージ容量不足
- [ ] ネットワークエラー（アップロード中断）
- [ ] タイムアウト
- [ ] 同時アップロード（複数ユーザーが同じ社員の写真を更新）
- [ ] 権限エラー（他人の写真を更新しようとした場合）

**仕様の明確化が必要な点**:
1. アップロード失敗時のリトライ処理は？
2. 部分的にアップロードされたファイルの扱いは？
3. トランザクション管理は？（DBとファイルの整合性）

### 2.3 顔写真表示時のエラーケース

**チェック項目**:
- [ ] 顔写真未登録の場合のデフォルト画像
- [ ] ファイルが物理削除されている場合
- [ ] ファイルパスが不正な場合
- [ ] 画像ファイルが破損している場合
- [ ] 画像読み込みタイムアウト

**仕様の明確化が必要な点**:
1. デフォルト画像は用意するか？
2. 画像が見つからない場合の表示は？（エラー、空白、アイコンなど）
3. サムネイル生成は行うか？

### 2.4 顔写真の更新・削除

**チェック項目**:
- [ ] 既存の顔写真を上書きする場合の挙動
- [ ] 古い画像ファイルの削除タイミング
- [ ] 顔写真の削除（未登録状態に戻す）機能の有無
- [ ] 社員削除時の顔写真ファイルの扱い

**仕様の明確化が必要な点**:
1. 顔写真の更新履歴は保持するか？
2. 古い画像ファイルは即座に削除するか、バッチ処理か？
3. 顔写真を削除する機能は必要か？

## 3. 組織階層変更時の制約

### 3.1 組織の追加

**チェック項目**:
- [ ] 親組織が存在しない場合（ルート組織の追加）
- [ ] 親組織が削除済みの場合
- [ ] 組織コードの重複チェック
- [ ] 組織名の重複チェック（同一親配下での重複）
- [ ] 階層の深さ制限

**仕様の明確化が必要な点**:
1. ルート組織は複数存在できるか？
2. 組織コードは全社で一意か、親組織内で一意か？
3. 組織階層の最大深さは？

### 3.2 組織の編集

**チェック項目**:
- [ ] 組織名の変更
- [ ] 組織コードの変更（既存データへの影響）
- [ ] 親組織の変更（組織ツリーの再構築）
- [ ] 親組織を自分自身に設定しようとした場合
- [ ] 親組織を自分の子孫に設定しようとした場合（循環参照）

**仕様の明確化が必要な点**:
1. 親組織の変更は許可するか？
2. 循環参照のチェックロジックは？
3. 組織コード変更時の影響範囲は？

### 3.3 組織の削除

**チェック項目**:
- [ ] 所属社員がいる組織の削除
- [ ] 子組織がある組織の削除
- [ ] 削除済み組織の再表示（論理削除のため）
- [ ] 削除済み組織に所属する社員の扱い
- [ ] 組織ツリー表示での削除済み組織の扱い

**仕様の明確化が必要な点**:
1. 所属社員がいる組織は削除できるか？
2. 子組織がある組織は削除できるか？
3. 組織削除時、所属社員はどうなるか？（組織未所属、エラー、など）
4. 子組織も連鎖削除するか？

### 3.4 組織階層の整合性

**チェック項目**:
- [ ] 孤立した組織（親が削除済み）の扱い
- [ ] 組織レベルの自動計算
- [ ] 組織ツリーの再構築タイミング
- [ ] 大量の組織変更時のパフォーマンス

**仕様の明確化が必要な点**:
1. organization_levelは自動計算か、手動設定か？
2. 親組織変更時、配下の組織レベルも自動更新するか？
3. 組織ツリーはキャッシュするか？

## 4. スキルマスタ変更時の影響

### 4.1 スキルマスタの追加

**チェック項目**:
- [ ] スキル名の重複チェック
- [ ] スキルカテゴリの妥当性チェック
- [ ] スキルコードの採番ルール（あれば）
- [ ] 説明文の必須/任意

**仕様の明確化が必要な点**:
1. スキル名は全社で一意か？
2. スキルカテゴリはマスタ管理か、自由入力か？
3. スキルの並び順は？（カテゴリ順、名前順など）

### 4.2 スキルマスタの編集

**チェック項目**:
- [ ] スキル名の変更（既存の社員スキルへの影響）
- [ ] スキルカテゴリの変更（既存の社員スキルへの影響）
- [ ] 説明文の変更
- [ ] 変更履歴の記録（MVP対象外の可能性あり）

**仕様の明確化が必要な点**:
1. スキル名変更は許可するか？
2. スキル名変更時、既存の社員スキルは自動更新されるか？
3. スキルカテゴリ変更の影響範囲は？

### 4.3 スキルマスタの削除

**チェック項目**:
- [ ] 社員が保有しているスキルの削除
- [ ] 削除済みスキルを持つ社員の表示
- [ ] スキル検索での削除済みスキルの扱い
- [ ] スキル選択画面での削除済みスキルの扱い

**仕様の明確化が必要な点**:
1. 社員が保有しているスキルは削除できるか？
2. 削除できる場合、社員スキルも連鎖削除するか？
3. 削除できない場合、エラーメッセージは？
4. 削除済みスキルを持つ社員の詳細画面での表示は？

### 4.4 社員スキルとの整合性

**チェック項目**:
- [ ] 削除済みスキルマスタを参照する社員スキルの扱い
- [ ] スキルマスタ削除時の社員スキルの連鎖削除
- [ ] スキル名変更時の検索結果への影響
- [ ] スキルカテゴリ変更時の検索結果への影響

**仕様の明確化が必要な点**:
1. 外部キー制約はどう設定するか？（CASCADE、RESTRICT、SET NULLなど）
2. 論理削除の場合、削除済みスキルマスタへの参照は許可するか？
3. スキルマスタと社員スキルの整合性チェックは？

## 5. データ整合性の観点

### 5.1 同時更新制御

**チェック項目**:
- [ ] 複数ユーザーが同じ社員情報を同時編集
- [ ] 複数ユーザーが同じ組織を同時編集
- [ ] 複数ユーザーが同じスキルマスタを同時編集
- [ ] 楽観的ロック／悲観的ロックの選択

**仕様の明確化が必要な点**:
1. 同時更新制御は実装するか？
2. 楽観的ロックを使用する場合、バージョン番号フィールドは？
3. 同時更新エラー時のユーザーへの通知方法は？

### 5.2 参照整合性

**チェック項目**:
- [ ] 社員の所属組織が削除された場合
- [ ] 社員のスキルが削除された場合
- [ ] 組織の親組織が削除された場合
- [ ] ユーザーの紐づく社員が削除された場合

**仕様の明確化が必要な点**:
1. 外部キー制約の設定方針は？
2. 論理削除の場合、削除済みレコードへの参照は許可するか？
3. 参照整合性エラー時の挙動は？

### 5.3 トランザクション境界

**チェック項目**:
- [ ] 社員情報と顔写真の同時更新
- [ ] 社員情報と社員スキルの同時更新
- [ ] 組織階層の一括更新
- [ ] ロールバック時のファイル削除

**仕様の明確化が必要な点**:
1. トランザクション境界はどこか？
2. ファイル操作とDB操作の整合性をどう保つか？
3. エラー時のロールバック範囲は？

## 6. バリデーションの観点

### 6.1 入力値の妥当性チェック

**チェック項目**:
- [ ] 必須項目のチェック
- [ ] 文字列長のチェック（最小/最大）
- [ ] 文字種のチェック（英数字のみ、など）
- [ ] 日付の妥当性チェック（未来日、過去日）
- [ ] メールアドレスの形式チェック
- [ ] 数値の範囲チェック（スキルレベル1-3）

**仕様の明確化が必要な点**:
1. 各項目の必須/任意は？
2. 各項目の最大文字数は？
3. 入社日は未来日を許可するか？

### 6.2 業務ルールのチェック

**チェック項目**:
- [ ] 社員コードの重複チェック
- [ ] メールアドレスの重複チェック
- [ ] 同一社員への同一スキルの重複登録
- [ ] 組織階層の循環参照チェック
- [ ] 削除済みレコードへの参照チェック

**仕様の明確化が必要な点**:
1. 社員コードは自動採番か、手動入力か？
2. メールアドレスは全社で一意か？
3. 同一スキルを複数回登録できるか？（レベル変更の場合）

### 6.3 エラーメッセージ

**チェック項目**:
- [ ] バリデーションエラーの表示位置（項目ごと、画面上部）
- [ ] エラーメッセージの内容（具体的、わかりやすい）
- [ ] 複数エラーの表示方法（すべて表示、最初のみ）
- [ ] エラー項目へのフォーカス移動

**仕様の明確化が必要な点**:
1. エラーメッセージの表示方式は？
2. エラーメッセージの文言は？
3. 多言語対応は？（MVP対象外の可能性あり）

## 7. パフォーマンスの観点

### 7.1 検索パフォーマンス

**チェック項目**:
- [ ] 大量データでの検索速度（1000件、10000件）
- [ ] 複雑な検索条件での速度
- [ ] インデックスの設定
- [ ] N+1問題の回避

**仕様の明確化が必要な点**:
1. 想定データ量は？（社員数、組織数、スキル数）
2. パフォーマンス要件は？（3秒以内、など）
3. インデックスを設定する項目は？

### 7.2 画像表示のパフォーマンス

**チェック項目**:
- [ ] 一覧画面での複数画像の同時読み込み
- [ ] 画像のキャッシュ
- [ ] サムネイル生成
- [ ] 遅延読み込み（Lazy Loading）

**仕様の明確化が必要な点**:
1. サムネイルは生成するか？
2. 画像のキャッシュ戦略は？
3. 一覧画面での画像表示サイズは？

### 7.3 組織ツリーのパフォーマンス

**チェック項目**:
- [ ] 深い階層での表示速度
- [ ] 大量の組織での表示速度
- [ ] ツリー展開/折りたたみの速度
- [ ] 再帰クエリの最適化

**仕様の明確化が必要な点**:
1. 組織階層の最大深さは？
2. 想定組織数は？
3. ツリー表示は全展開か、段階的展開か？

## 8. セキュリティの観点

### 8.1 認証・認可

**チェック項目**:
- [ ] 未ログイン状態でのアクセス制御
- [ ] セッションタイムアウト後のアクセス制御
- [ ] 権限外の操作の制御（一般社員が他人の情報を編集）
- [ ] APIの認証チェック

**仕様の明確化が必要な点**:
1. 未ログイン時のリダイレクト先は？
2. セッションタイムアウト時のメッセージは？
3. 権限エラー時の表示は？

### 8.2 入力値のサニタイジング

**チェック項目**:
- [ ] SQLインジェクション対策
- [ ] XSS対策
- [ ] パストラバーサル対策（ファイルアップロード）
- [ ] CSRFトークンの使用

**仕様の明確化が必要な点**:
1. フレームワークのデフォルト対策で十分か？
2. 追加のサニタイジング処理は必要か？

### 8.3 ファイルアップロードのセキュリティ

**チェック項目**:
- [ ] 実行可能ファイルのアップロード防止
- [ ] ファイル名のサニタイジング
- [ ] ファイルの保存先（公開ディレクトリ外）
- [ ] ファイルアクセスの認証

**仕様の明確化が必要な点**:
1. アップロード可能なファイル形式の制限は？
2. ファイルの保存先ディレクトリは？
3. ファイルアクセス時の認証は必要か？

## 9. 運用の観点

### 9.1 初期データ投入

**チェック項目**:
- [ ] 組織マスタの初期データ
- [ ] スキルマスタの初期データ
- [ ] 管理者ユーザーの初期データ
- [ ] テストデータの準備

**仕様の明確化が必要な点**:
1. 初期データの投入方法は？（SQL、CSV、画面操作）
2. 初期データの内容は誰が決めるか？
3. テストデータは本番環境に含めるか？

### 9.2 データメンテナンス

**チェック項目**:
- [ ] 削除済みデータの物理削除タイミング
- [ ] 古い顔写真ファイルの削除
- [ ] セッションデータのクリーンアップ
- [ ] ログファイルのローテーション

**仕様の明確化が必要な点**:
1. 論理削除されたデータはいつ物理削除するか？
2. 古いファイルの削除はバッチ処理か？
3. データ保持期間は？

### 9.3 バックアップ・リストア

**チェック項目**:
- [ ] データベースのバックアップ
- [ ] 顔写真ファイルのバックアップ
- [ ] バックアップの世代管理
- [ ] リストア手順の確認

**仕様の明確化が必要な点**:
1. バックアップの頻度は？（日次、週次）
2. バックアップの保持期間は？
3. リストア手順は文書化されているか？

## 10. 優先度付け

### 高優先度（MVP実装前に必ず明確化が必要）
- 検索条件の組み合わせ（AND/OR）
- 顔写真のバリデーション（形式、サイズ）
- 組織削除時の制約（所属社員、子組織）
- スキルマスタ削除時の制約（社員スキル）
- 論理削除の実装方針
- 同時更新制御の有無

### 中優先度（実装中に決定可能）
- 検索条件の保持
- デフォルト画像の用意
- 組織階層の最大深さ
- エラーメッセージの文言
- インデックス設計

### 低優先度（デフォルト値で進めて後で調整可能）
- サムネイル生成
- 画像キャッシュ戦略
- データメンテナンスのタイミング
- バックアップの世代管理
